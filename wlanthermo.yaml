button_card_templates:
  wlt_card_base:
    variables:
      device_name: wlanthermo
      bt_name: phyrawadv_03c9
    show_icon: true
    show_name: true
    show_state: true
    styles:
      grid:
        - row-gap: 2px
      card:
        - padding: 4px
        - height: 70px
        - border-radius: 12px
      name:
        - font-size: 14px
        - font-weight: bold
        - align-self: end
      icon:
        - width: 22px
        - height: 22px
        - align-self: center
      custom_fields:
        time_left:
          - font-size: 12px
          - align-self: start
        minmax:
          - align-self: start
          - font-size: 12px
          - >
            .minmax-wrapper {
              display: flex;
              justify-content: space-between;
              align-items: center;
              width: 100%;
            }
            .minmax-left, .minmax-right {
              display: flex;
              align-items: center;
              gap: 4px;
            }
            ha-icon {
              --mdc-icon-size: 14px;
            }
        min:
          - font-size: 12px
          - justify-self: end
          - align-self: end
        max:
          - font-size: 12px
          - justify-self: end
          - align-self: end
  wlt_status_base:
    template: wlt_card_base
    styles:
      grid:
        - grid-template-areas: '"i n" "i s"'
        - grid-template-columns: 44px 1fr
        - grid-template-rows: auto auto
        - column-gap: 10px
        - align-items: center
      icon:
        - width: 36px
        - height: 36px
        - color: '#8a8f98'
      name:
        - font-size: 13px
        - color: '#cfd3d6'
      state:
        - font-size: 12px
        - color: '#9aa0a6'
  wlt_kanal_button:
    template: wlt_card_base
    show_icon: false
    show_state: false
    name: |
      [[[
        const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
        const dev = variables.device_name;
        return states[`text.${dev}_kanal_${id}_name`]?.state;
      ]]]
    custom_fields:
      icon: |
        <ha-icon icon="mdi:thermometer" style="--mdc-icon-size: 24px;"></ha-icon>
      temp: |
        [[[
          const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
          const dev = variables.device_name;
          const t = parseFloat(
            states[`sensor.${dev}_kanal_${id}_temperatur`]?.state
          );
          const sp = parseFloat(
            states[`number.${dev}_kanal_${id}_maximum`]?.state
          );
          const sm = parseFloat(
            states[`number.${dev}_kanal_${id}_minimum`]?.state
          );
          if (isNaN(t) || isNaN(sp)) return "–";
          const r = Math.min(1, t / sp);
          const color =
            t < sm ? '60, 170, 230' :
            r < 0.8 ? '0,180,0' :
            r < 1.0 ? '255,180,0' :
                      '200,0,0';
          return `
            <div style="
              width:100%;
              text-align:center;
              padding:6px;
              border-radius:10px;
              background: linear-gradient(
                to right,
                rgba(${color},0.6) ${r*100}%,
                rgba(0,0,0,0.15) ${r*100}%
              );
            ">
              ${t.toFixed(1)}°C
            </div>
          `;
        ]]]
      max: |
        [[[
          const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
          const dev = variables.device_name;
          const max = states[`number.${dev}_kanal_${id}_maximum`]?.state;
          return `<ha-icon icon="mdi:chevron-up" style="--mdc-icon-size:14px;"></ha-icon>
                ${max}°C`;
        ]]]

      min: |
        [[[
          const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
          const dev = variables.device_name;
          const min = states[`number.${dev}_kanal_${id}_minimum`]?.state;
          return `<ha-icon icon="mdi:chevron-down" style="--mdc-icon-size:14px;"></ha-icon>
                ${min}°C`;
        ]]]

      time_left: |
        [[[
          const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
          const dev = variables.device_name;
          const r = states[`sensor.${dev}_kanal_${id}_restzeit`]?.state;
          return r && r !== "0" ? `⏱ ${r}` : "⏱ ~";
        ]]]

    styles:
      grid:
        - grid-template-areas: |
            "name        temp    max"
            "icon        temp    max"
            "icon        temp    min"
            "icon    time_left   min"
        - grid-template-columns: 60px 1fr 60px
        - grid-template-rows: auto auto auto auto

      name:
        - grid-area: name
        - font-size: 12px
        - font-weight: normal

      custom_fields:
        icon:
          - grid-area: icon
          - align-self: center
        temp:
          - grid-area: temp
          - font-size: 18px
          - font-weight: bold
        max:
          - grid-area: max
          - font-size: 12px
          - opacity: 1
        min:
          - grid-area: min
          - font-size: 12px
          - opacity: 1
        time_left:
          - grid-area: time_left
          - font-size: 12px
          - opacity: 1
          - color: '#9aa0a6'
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: |
            [[[
              const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
              return "Kanal " + id;
            ]]]
          content:
            type: entities
            entities:
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `sensor.${dev}_kanal_${id}_temperatur`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `sensor.${dev}_kanal_${id}_restzeit`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `text.${dev}_kanal_${id}_name`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `number.${dev}_kanal_${id}_minimum`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `number.${dev}_kanal_${id}_maximum`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `select.${dev}_kanal_${id}_alarmmodus`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `light.${dev}_kanal_${id}_farbe`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/kanal_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `select.${dev}_kanal_${id}_sensortyp`;
                ]]]
  wlt_pitmaster_button:
    template: wlt_card_base
    show_icon: false
    show_name: false
    show_state: false
    icon: mdi:thermometer
    variables:
      device_name: wlanthermo
    name: |
      [[[
        const id = parseInt(entity.entity_id.match(/pitmaster_(\d+)_/)[1]);
        const temp = entity.state !== 'unavailable' ? entity.state + "°C" : "N/A";
        return "Pitmaster " + (id) + "  " + temp;
      ]]]
    custom_fields:
      fan: |
        [[[
          const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
          const dev = variables.device_name;
          const spd = parseFloat(states[`sensor.${dev}_pitmaster_${id}_leistung`]?.state || 0);
          const duration = Math.max(0.4, 3 - spd/30);
          const anim = spd > 0
            ? `animation: wlt_spin_${id} ${duration}s linear infinite;`
            : `animation: none;`;
          return `
            <style>
              @keyframes wlt_spin_${id} {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
              }
            </style>
            <div style="text-align:center">
              <ha-icon icon="mdi:fan" style="
                color: hsl(${120 - spd}, 80%, 50%);
                ${anim}
                display: inline-block;
              "></ha-icon>
            </div>
          `;
        ]]]
      temp: |
        [[[
          const id = parseInt(entity.entity_id.match(/pitmaster_(\d+)_/)[1]);
          const dev = variables.device_name;
          const t = parseFloat(
            states[`sensor.${dev}_pitmaster_${id}_temperatur`]?.state
          );
          const sp = parseFloat(
            states[`number.${dev}_pitmaster_${id}_solltemperatur`]?.state
          );
          if (isNaN(t) || isNaN(sp)) return "–";
          const r = Math.min(1, t / sp);
          const color =
            r < 0.8 ? '0,180,0' :
            r < 1.0 ? '255,180,0' :
                      '200,0,0';
          return `
            <div style="
              width:100%;
              text-align:center;
              padding:6px;
              border-radius:10px;
              background: linear-gradient(
                to right,
                rgba(${color},0.6) ${r*100}%,
                rgba(0,0,0,0.15) ${r*100}%
              );
            ">
              ${sp.toFixed(1)}°C
            </div>
          `;
        ]]]
      info: |
        [[[
          const id = parseInt(entity.entity_id.match(/pitmaster_(\d+)_/)[1]);
          const dev = variables.device_name;
          const sp = states[`number.${dev}_pitmaster_${id}_solltemperatur`]?.state;
          const spd = states[`sensor.${dev}_pitmaster_${id}_leistung`]?.state;
          const t = states[`sensor.${dev}_pitmaster_${id}_temperatur`]?.state;
          const speedText =
            spd && spd !== "0"
              ? ` ${spd} %`
              : " ~ %";
          return `
            <div style="font-size:13px; line-height:1.4">
              <b>Pit ${id}</b><br>
              ${t}°C<br>
              ${speedText}
            </div>
          `;
        ]]]
    styles:
      grid:
        - grid-template-columns: 70px 1fr 80px
        - grid-template-areas: '"fan temp info"'
        - align-items: center
      custom_fields:
        fan:
          - grid-area: fan
          - justify-self: start
          - align-self: center
          - font-size: 20px
        temp:
          - grid-area: temp
          - overflow: visible
          - text-overflow: unset
          - justify-self: stretch
          - font-size: 28px
          - font-weight: bold
          - color: '#e8eaed'
        info:
          - grid-area: info
          - justify-self: end
          - font-size: 12px
          - line-height: 1.4
          - color: '#cfd3d6'
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: |
            [[[
              const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
              return "Pitmaster " + id;
            ]]]
          content:
            type: entities
            entities:
              - |
                [[[
                  const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `number.${dev}_pitmaster_${id}_leistung`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `number.${dev}_pitmaster_${id}_solltemperatur`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `select.${dev}_pitmaster_${id}_kanal`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `select.${dev}_pitmaster_${id}_pid_profil`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pitmaster_(\d+)_/)[1];
                  const dev = variables.device_name;
                  return `select.${dev}_pitmaster_${id}_modus`;
                ]]]
  wlt_pitprofil_button:
    template: wlt_card_base
    show_icon: false
    show_state: false
    icon: mdi:thermometer
    name: |
      [[[
        const dev = variables.device_name;
        const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
        return states[`text.${dev}_pid_profil_${id}_name`]?.state;
      ]]]
    styles:
      name:
        - align-self: center
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: |
            [[[
              const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
              return "Pit Profil " + id;
            ]]]
          content:
            type: entities
            entities:
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `text.${variables.device_name}_pid_profil_${id}_name`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `select.${variables.device_name}_pid_profil_${id}_aktor`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `switch.${variables.device_name}_pid_profil_${id}_deckelerkennung`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `number.${variables.device_name}_pid_profil_${id}_startleistung_jp`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `number.${variables.device_name}_pid_profil_${id}_pwm_minimum`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `number.${variables.device_name}_pid_profil_${id}_pwm_maximum`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `number.${variables.device_name}_pid_profil_${id}_servo_minimum`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `number.${variables.device_name}_pid_profil_${id}_servo_maximum`;
                ]]]
              - |
                [[[
                  const id = entity.entity_id.match(/pid_profil_(\d+)_/)[1];
                  return `switch.${variables.device_name}_pid_profil_${id}_aktor_verknupfung`;
                ]]]
  wlt_notification_button:
    template: wlt_card_base
    show_icon: false
    show_state: false
    icon: mdi:thermometer
    name: |
      [[[
        return "Benachichtigungen";
      ]]]
    styles:
      card:
        - background: |
            [[[
              const pushover = states['switch.wlanthermo_push_pushover_aktiv']?.state === 'on';
              const telegram = states['switch.wlanthermo_push_telegram_aktiv']?.state === 'on';
              const left = pushover ? 'rgba(140,140,140,1)' : 'rgba(140,140,140,0.1)';
              const right = telegram ? 'rgba(140,140,140,1)' : 'rgba(140,140,140,0.1)';
              return `
                linear-gradient(
                  to right,
                  ${left},
                  ${right}
                )
              `;
            ]]]
      name:
        - align-self: center
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: Benachrichtigungen
          content:
            type: entities
            entities:
              - switch.wlanthermo_push_pushover_aktiv
              - select.wlanthermo_push_pushover_prioritat
              - text.wlanthermo_push_pushover_token
              - text.wlanthermo_push_pushover_user_key
              - button.wlanthermo_push_pushover_testen
              - switch.wlanthermo_push_telegram_aktiv
              - text.wlanthermo_push_telegram_token
              - text.wlanthermo_push_telegram_chat_id
              - button.wlanthermo_push_telegram_testen
  wlt_bluetooth_button:
    template: wlt_card_base
    show_icon: false
    show_state: false
    icon: mdi:thermometer
    variables:
      device_name: wlanthermo
    name: |
      [[[
        return "Bluetooth";
      ]]]
    styles:
      card:
        - background-repeat: no-repeat
        - background-size: 100% 30%, 100% 40%, 100% 30%
        - background-position: bottom, center, top
        - background: |
            [[[
              const bt = states['switch.wlanthermo_bluetooth_aktiv']?.state === 'on';
              const bt_name = variables.bt_name;

              // Bluetooth AUS → ganze Karte rot
              if (!bt) {
                return 'linear-gradient(to right, rgba(200,0,0,1), rgba(200,0,0,1))';
              }

              // Bluetooth AN → Sensor-Felder
              const sensors = [
                  `switch.wlanthermo_bluetooth_${bt_name}_fuhler_1`,
                  `switch.wlanthermo_bluetooth_${bt_name}_fuhler_2`,
                  `switch.wlanthermo_bluetooth_${bt_name}_fuhler_3`,
                  `switch.wlanthermo_bluetooth_${bt_name}_fuhler_4`,
                  `switch.wlanthermo_bluetooth_${bt_name}_fuhler_5`,
                  `switch.wlanthermo_bluetooth_${bt_name}_fuhler_6`,
                ];
              // Farbe pro Sensor
              const colors = sensors.map(id =>
                states[id]?.state === 'on'
                  ? 'rgba(140,140,140,1)'   // aktiv → grün
                  : 'rgba(140,140,140,0.1)'   // inaktiv → rot
              );

              // Zwischen-Fades (20% transparent)
              const fades = colors.map(c => c.replace(',1)', ',0.8)'));

              // Gradient bauen: color1, fade1, color2, fade2, ...
              const parts = [];
              for (let i = 0; i < colors.length; i++) {
                parts.push(colors[i]);
                parts.push(colors[i]);
                if (i < fades.length - 1) parts.push(fades[i]);
              }
                parts.push(colors[colors.length-1]);

              return `linear-gradient(to right, ${parts.join(',')})`;
            ]]]
      name:
        - align-self: center
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: Bluetooth
          content:
            type: entities
            entities:
              - switch.wlanthermo_bluetooth_aktiv
              - |
                [[[
                  return `switch.wlanthermo_bluetooth_${variables.bt_name}_fuhler_1`;
                ]]]
              - |
                [[[
                  return `switch.wlanthermo_bluetooth_${variables.bt_name}_fuhler_2`;
                ]]]
              - |
                [[[
                  return `switch.wlanthermo_bluetooth_${variables.bt_name}_fuhler_3`;
                ]]]
              - |
                [[[
                  return `switch.wlanthermo_bluetooth_${variables.bt_name}_fuhler_4`;
                ]]]
              - |
                [[[
                  return `switch.wlanthermo_bluetooth_${variables.bt_name}_fuhler_5`;
                ]]]
              - |
                [[[
                  return `switch.wlanthermo_bluetooth_${variables.bt_name}_fuhler_6`;
                ]]]
  wlt_status_percent:
    template: wlt_status_base
    styles:
      icon:
        - color: |
            [[[
              const v = Number(entity.state);
              if (isNaN(v)) return 'rgba(160,160,160,0.8)';
              if (v > 60) return 'rgb(0,200,0)';
              if (v > 30) return 'rgb(255,180,0)';
              return 'rgb(200,0,0)';
            ]]]
  wlt_status_signal:
    template: wlt_status_base
    styles:
      icon:
        - color: |
            [[[
              const v = Number(entity.state);
              if (isNaN(v)) return 'rgba(160,160,160,0.8)';
              if (v > -60) return 'rgb(0,200,0)';
              if (v > -75) return 'rgb(255,180,0)';
              return 'rgb(200,0,0)';
            ]]]
  wlt_status_presence:
    template: wlt_status_base
    styles:
      icon:
        - color: |
            [[[
              const v = entity.state;
              if (!v || v === 'unavailable' || v === 'unknown')
                return 'rgb(200,0,0)';
              if (v === 'standby')
                return 'rgb(255,180,0)';
              return 'rgb(0,200,0)';
            ]]]
  wlt_status_charge:
    template: wlt_status_base
    styles:
      icon:
        - color: |
            [[[
              const charging = states['sensor.wlanthermo_ladevorgang_batterie']?.state;
              const soc = Number(states['sensor.wlanthermo_batteriestand']?.state ?? 0);

              if (['true','on','online','connected','True','1'].includes(charging))
                return 'rgb(0,200,0)';            // charging

              if (['false','off','False','0'].includes(charging) && soc === 100)
                return 'rgb(0,150,255)';          // plugged, full

              if (['false','off','False','0'].includes(charging))
                return 'rgb(200,200,0)';          // battery only

              return 'rgb(150,150,150)';          // unknown
            ]]]
  wlt_status_info:
    template: wlt_status_base
    styles:
      icon:
        - color: |
            [[[
              const v = entity.state;
              if (v === 'unavailable' || v === 'unknown')
                return 'rgba(160,160,160,0.8)';

              if (['on','true','connected','verbunden'].includes(v))
                return 'rgb(0,200,0)';

              if (['off','false','disconnected','getrennt'].includes(v))
                return 'rgb(255,0,0)';

              if (['standby'].includes(v))
                return 'rgb(255,180,0)';

              return 'rgba(255,255,255,0.9)';
            ]]]
  wlt_cloud_button:
    template: wlt_status_info
    name: |
      [[[
        return "Cloud";
      ]]]
    icon: mdi:cloud
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: Cloud Status
          content:
            type: entities
            entities:
              - button.wlanthermo_iot_cloud_token_neu_generieren
              - switch.wlanthermo_iot_cloud_upload_aktivieren
              - sensor.wlanthermo_cloud_link
  wlt_mqtt_button:
    template: wlt_status_info
    name: |
      [[[
        return "MQTT";
      ]]]
    icon: mdi:satellite-variant
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          title: MQTT Status
          content:
            type: entities
            entities:
              - switch.wlanthermo_iot_mqtt_aktivieren
              - text.wlanthermo_iot_mqtt_benutzer
              - text.wlanthermo_iot_mqtt_host
              - text.wlanthermo_iot_mqtt_passwort
              - number.wlanthermo_iot_mqtt_port
              - number.wlanthermo_iot_mqtt_intervall
              - number.wlanthermo_iot_mqtt_qos
views:
  - title: WLANThermo
    path: wlanthermo
    type: panel
    icon: mdi:grill
    cards:
      - type: grid
        columns: 1
        square: false
        cards:
          - type: custom:auto-entities
            card:
              type: grid
              columns: 8
              square: false
            filter:
              include:
                - entity_id: sensor.wlanthermo_kanal_*_temperatur
                  options:
                    type: custom:button-card
                    template: wlt_kanal_button
              exclude:
                - state: unavailable
                - state: unknown
              sort:
                method: attribute
                attribute: id
                numeric: true
            card_param: cards
          - type: grid
            columns: 2
            square: false
            cards:
              - type: grid
                columns: 1
                square: false
                cards:
                  - type: custom:auto-entities
                    card:
                      type: history-graph
                      hours_to_show: 1
                      fit_y_data: false
                      min_y_axis: 10
                      max_y_axis: 100
                    filter:
                      include:
                        - entity_id: sensor.wlanthermo_kanal_*_temperatur
                      exclude:
                        - state: unavailable
                        - state: unknown
                    sort:
                      method: entity_id
                    card_param: entities
              - type: grid
                columns: 1
                square: false
                cards:
                  - type: custom:auto-entities
                    card:
                      type: grid
                      columns: 2
                      square: false
                    filter:
                      include:
                        - entity_id: sensor.wlanthermo_pitmaster_*_temperatur
                          options:
                            type: custom:button-card
                            template: wlt_pitmaster_button
                      exclude:
                        - state: unavailable
                        - state: unknown
                    sort:
                      method: entity_id
                    card_param: cards
                  - type: grid
                    columns: 4
                    square: false
                    cards:
                      - type: custom:button-card
                        entity: sensor.wlanthermo_batteriestand
                        name: Akku
                        icon: mdi:battery
                        template: wlt_status_charge
                      - type: custom:button-card
                        entity: sensor.wlanthermo_signalstarke
                        name: WLAN
                        icon: mdi:wifi
                        template: wlt_status_signal
                      - type: custom:button-card
                        entity: sensor.wlanthermo_cloud_status
                        template: wlt_cloud_button
                      - type: custom:button-card
                        entity: sensor.wlanthermo_system_info
                        name: System Info
                        icon: mdi:cog-outline
                        template: wlt_status_info
                      - type: custom:button-card
                        entity: sensor.wlanthermo_ladevorgang_batterie
                        name: Ladung
                        icon: mdi:power-plug
                        template: wlt_status_info
                      - type: custom:button-card
                        entity: switch.wlanthermo_iot_mqtt_aktivieren
                        name: MQTT
                        template: wlt_mqtt_button
                      - type: custom:button-card
                        entity: sensor.wlanthermo_system_zeit
                        name: Zeit
                        icon: mdi:clock
                        template: wlt_status_info
                      - type: custom:button-card
                        entity: sensor.wlanthermo_gerate_info
                        name: Geräteinfo
                        icon: mdi:devices
                        template: wlt_status_info
                  - type: custom:auto-entities
                    card:
                      type: grid
                      columns: 4
                      square: false
                    filter:
                      include:
                        - entity_id: text.wlanthermo_pid_profil_*_name
                          options:
                            type: custom:button-card
                            template: wlt_pitprofil_button
                    sort:
                      method: entity_id
                    card_param: cards
                  - type: grid
                    columns: 2
                    square: false
                    cards:
                      - type: custom:button-card
                        entity: switch.wlanthermo_push_pushover_aktiv
                        name: Benachrichtigungen
                        icon: mdi:battery
                        template: wlt_notification_button
                      - type: custom:button-card
                        entity: switch.wlanthermo_bluetooth_aktiv
                        name: Bluetooth
                        icon: mdi:battery
                        template: wlt_bluetooth_button
          - type: custom:auto-entities
            card:
              type: custom:apexcharts-card
              update_interval: 5sec
              header:
                show: false
                show_states: true
              apex_config:
                chart:
                  height: 400
              yaxis:
                - id: '1'
                  opposite: true
                  min: 0
                  max: 100
                - id: '0'
                  min: 0
                  max: 200
                  opposite: false
            filter:
              exclude:
                - state: unavailable
                - state: unknown
              include:
                - entity_id: sensor.wlanthermo_pitmaster_*_leistung
                  options:
                    yaxis_id: '1'
                    stroke_width: 1
                    type: area
                    opacity: 0.25
                    curve: stepline
                - entity_id: sensor.wlanthermo_pitmaster_*_temperatur
                  options:
                    yaxis_id: '0'
                    stroke_width: 1
                - entity_id: sensor.wlanthermo_kanal_*_temperatur
                  options:
                    yaxis_id: '0'
                    stroke_width: 3
            sort:
              method: entity_id
            card_param: series
